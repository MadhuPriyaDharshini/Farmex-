<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="bootstrap-5.2.2-dist/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="bootstrap-5.2.2-dist/css/bootstrap.min.css" id="bootstrap-css">
  <link rel="stylesheet" href="MDB5-STANDARD-UI-KIT-Free-5.0.0/css/mdb.min.css">
  <link rel="stylesheet" href="feed.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

</head>

<body>
  <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="farmer_frd.jpeg" alt="Logo" style="width:40px;" class="rounded-pill"/>
      </a>
      <!--<div className="bn40div">
        <a class="bn40" href="/">FARMEX</a>
      </div>-->
      <h3 class="nav_h3">FARMEX</h3>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
        <span class="navbar-toggler-icon"></span>
      </button>


      <ul class="nav-bar">

       <!-- <li class="nav-item ">
          <a href="/" class="nav-link text-white px-1 py-1 navbar-bold-markup" alt="Link to Welcome to the Zoo Page"
            title="Link to Welcome to the Zoo Page" aria-label="Link to Welcome to the Zoo Page">Nav</a></a>

        </li>-->
        <li class="nav-item">
          <a href="userinfo.html" class="nav-links">Home</a>
        </li>
        <li class="nav-item">
        <li>
          <a href="Help.html" class="nav-links">Help</a>
        </li>
        <li class="nav-item">
          <a href="news.html" class="nav-links"> News
            
          </a>
        </li>
        <li class="nav-item">
          <a href="sign_in.html" class="nav-links"> Login
            
          </a>
        </li>
      </ul>
      <form class="d-flex">
        <div id="google_translate_element"></div>
      </form>
    </div>
    </div>

  </nav>


  <div class="header">
    <div class="inner-header flex">
      <div class="container-fluid gedf-wrapper">
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="col-md-6 gedf-main" id="Row1">
            <div class="card gedf-card" id="FeedCard">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex justify-content-between align-items-center">

                    <div class="ml-2">
                      <div class="h5 m-0" id="UserName0"></div>
                      <div class="h7 text-muted" id="FullName0">Miracles Lee Cross</div>

                    </div>
                  </div>

                </div>

              </div>
              <div class="card-body">
                <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o" id="Time"></i></div>
                <a class="card-link" href="#">
                  <h5 class="card-title" id="Question0">Lorem ipsum dolor sit amet, consectetur adip.</h5>
                </a>

                <p class="card-text" id="Solution0">
                  Lorem ipsum dolor sit amet consectetur adipisicing elit. Quo recusandae nulla rem eos ipsa praesentium
                  esse magnam nemo dolor
                  sequi fuga quia quaerat cum, obcaecati hic, molestias minima iste voluptates.
                </p>

                <img class="img-fluid rounded mb-3" alt="farmex.jpg" id="image0" style="text-align: center;" />

              </div>
              <div class="card-footer">
                <a href="#" class="card-link"><i class="fa fa-gittip"></i> Upvote</a>
                <a href="#" class="card-link"><i class="fa fa-comment"></i> Downvote</a>
                <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Comment </a>
              </div>
              <div class="card-footer">

                <form id="answers0">
                  <input type="text" class="form-control" id="InputAnswers" aria-describedby="emailHelp"
                    placeholder="Type your answer here" name="answer">
                  <br>
                  <div class="sm-3">
                    <input type="submit" class="btn btn-primary btn-block mb-4"></input>
                  </div>
                </form>
                <div class="container mt-5">
                  <div class="d-flex justify-content-start row">
                    <div class="col-md-8 w-100">
                      <div class="d-flex flex-column comment-section w-100" id="parentComponent">
                        <div class="bg-white p-2">
                          <div class="d-flex flex-row user-info"><img class="rounded-circle"
                              src="https://cdn.pixabay.com/photo/2018/08/28/12/41/avatar-3637425__340.png" width="40">
                            <div class="d-flex flex-column justify-content-start ml-2"><span
                                class="d-block font-weight-bold name" id="Name0">Marry Andrews</span><span
                                class="date text-black-50" id="Date0">
                                Jan 2020</span></div>
                          </div>
                          <div class="mt-2">
                            <p class="comment-text" id="Answer0">Lorem ipsum dolor sit amet, consectetur adipiscing
                              elit, sed do
                              eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                              nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                          </div>
                        </div>
                        <div class="bg-white">
                          <div class="d-flex flex-row fs-12">
                            <div class="like p-2 cursor"><i class="fa fa-thumbs-o-up"></i><span class="ml-1"
                                id="Likes0">Like</span>
                            </div>
                          </div>
                        </div>
                        <hr class="my-0" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script defer>
    document.getElementById('FullName0').innerHTML = window.localStorage.getItem('UserName');
    document.getElementById('Question0').innerHTML = window.localStorage.getItem('Question');
    document.getElementById('Solution0').innerHTML = window.localStorage.getItem('Solution');
    document.getElementById('image0').src = window.localStorage.getItem('ImageSrc');

    let dataTodisplay = [];

    window.onload = async function () {
      await showAllAnswer();
      dataTodisplay = JSON.parse(window.localStorage.getItem("ContentToDisplay"));
      console.log(dataTodisplay[0].answer);
      console.log(dataTodisplay.length);
      for (let j = 0; j < dataTodisplay.length - 1; j++) {
        const parentDiv = document.getElementById('parentComponent');
        const cloneOfParentDiv = parentDiv.cloneNode(true);
        const UpdatedIdofParentDiv = "parentComponent" + j;
        cloneOfParentDiv.id = UpdatedIdofParentDiv;
        parentDiv.parentNode.appendChild(cloneOfParentDiv);
        const cloneChilds = document.getElementById(UpdatedIdofParentDiv).childNodes;
        console.log(cloneChilds);
        const a = j + 1;
        cloneChilds[1].childNodes[1].childNodes[2].childNodes[0].id = "Name" + a;
        cloneChilds[1].childNodes[1].childNodes[2].childNodes[1].id = "Date" + a;
        cloneChilds[1].childNodes[3].childNodes[1].id = "Answer" + a;
        cloneChilds[3].childNodes[1].childNodes[1].childNodes[1].id = "Likes" + a;
      }

      for (let i = dataTodisplay.length-1; i >= 0; i--) {
        document.getElementById('Name' + i).innerHTML = dataTodisplay[i].user;
        document.getElementById('Date' + i).innerHTML = dataTodisplay[i].date;
        document.getElementById('Answer' + i).innerHTML = dataTodisplay[i].answer;
        document.getElementById('Likes' + i).innerHTML = dataTodisplay[i].upvotes;
      }
    };

    async function showAllAnswer() {
      let question = window.localStorage.getItem('Question');
      let payload1 = { question };
      await fetch("http://localhost:3000/api2/showAnswers", {
        method: "POST",
        headers: {
          "Content-type": "application/json; charset=UTF-8",
          Accept: "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        body: JSON.stringify(payload1),
      }).then(res => res.json()).then(data => {
        console.log(data);
        dataTostore = JSON.stringify(data.answers);
        window.localStorage.setItem("ContentToDisplay", dataTostore);
        window.localStorage.setItem("Dateitem", JSON.stringify(data.date));
        //window.location.href = window.location.href;
      });
      
    }

    const form = document.getElementById('answers0');
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      let answer = document.getElementById('InputAnswers').value;
      let question = window.localStorage.getItem('Question');
      const upvotes = 10;
      const user = window.localStorage.getItem('data');
      const currentDate = new Date();
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      const date = currentDate.toLocaleDateString('en-US', options);
      let payload = {
        answer,
        question,
        upvotes,
        user,
        date
      };
      console.log(payload);
      fetch("http://localhost:3000/api2/answers", {
        method: "POST",
        headers: {
          "Content-type": "application/json; charset=UTF-8",
          Accept: "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        body: JSON.stringify(payload),
      }).then(data => {
        console.log(data);
        alert("Answer Submitted Successfully");
        window.location.href = window.location.href;
      });
    });

  </script>

  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
    }
  </script>

  <script type="text/javascript"
    src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>

</html>